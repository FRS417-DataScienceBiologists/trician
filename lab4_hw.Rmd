---
title: "Lab 4 Homework"
author: "Joel Ledford"
date: "Winter 2019"
output:
  html_document:
    theme: spacelab
    toc: no
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Instructions
Answer the following questions and complete the exercises in RMarkdown. Please embed all of your code, keep track of your versions using git, and push your final work to our [GitHub repository](https://github.com/FRS417-DataScienceBiologists). I will randomly select a few examples of student work at the start of each session to use as examples so be sure that your code is working to the best of your ability.

## Load the libraries
```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(magrittr)
library(skimr)
```

## Mammal life history
Let's revisit the mammal life history data to practice our ggplot skills. The [data](http://esapubs.org/archive/ecol/E084/093/) are from: *S. K. Morgan Ernest. 2003. Life history characteristics of placental non-volant mammals. Ecology 84:3402.* The data are not tidy, so I am going to walk you through some steps to clean things up a bit.

```{r message=FALSE, warning=FALSE}
life_history <- readr::read_csv(file = "data/mammal_lifehistories_v2.csv")
```

### Examine variable names
```{r echo=FALSE}
names(life_history)
```

### Rename variables
Some of these variable names will be problematic. Let's rename them here. Note that I am replacing the data `%<>%`.
```{r}
life_history %<>% 
  dplyr::rename(
          genus        = Genus,
          wean_mass    = `wean mass`,
          max_life     = `max. life`,
          litter_size  = `litter size`,
          litters_yr   = `litters/year`
          )
```

### Skim
Notice the `-999` values. These should catch your attention as they likely represent NA's.
```{r}
life_history %>% 
  skimr::skim()
```

### Are there any NA's?
This result seems unlikely given the size of the dataset and the `-999` values.
```{r}
life_history %>%
  purrr::map_df(~ sum(is.na(.)))%>% 
  tidyr::gather(variables, num_nas) %>% 
  arrange(desc(num_nas))
```

### NA's in a single variable?
Notice how the `weaning` variable has 619 `-999` values alone.
```{r}
life_history %>% 
  count(weaning)
```

### Replace `-999` with NA and reassess
```{r}
life_history %<>% 
  na_if("-999")
```

### Now, are there any NA's?
Looks like there are a lot of missing data. Keep that in mind as you build plots.
```{r}
life_history %>%
  purrr::map_df(~ sum(is.na(.)))%>% 
  tidyr::gather(variables, num_nas) %>% 
  arrange(desc(num_nas))
```

##`ggplot()`
For the questions below, try to use the aesthetics you have learned to make visually appealing, customized, and informative plots. Make sure to include nice labels for the axes, titles, and keys when appropriate. Themes and colors are all up to you!
```{r}
options(scipen=999) #cancels the use of scientific notation for the session
```

1. What is the relationship between body mass and gestation? Make a scatterplot that shows this relationship. Color the points by order and incorporate the mass of each species.


2. What is the mean gestation time by mammalian order? Make a barplot that contrasts mean gestation time and fill by another variable (mean wean mass is interesting). You will need to use your dplyr skills to set this up before building the plot.
```{r}
by_order <- 
  life_history %>%
  group_by(order) %>% 
  summarize(mean_mass=mean(mass, na.rm=TRUE),
            mean_gestation=mean(gestation, na.rm=TRUE),
            mean_newborn=mean(newborn, na.rm=TRUE),
            mean_weaning=mean(weaning, na.rm=TRUE),
            mean_wean_mass=mean(wean_mass, na.rm=TRUE),
            mean_lifespan_mo=mean(max_life, na.rm = TRUE)) %>% 
  mutate(mean_lifespan_yr=(mean_lifespan_mo/12))
```

3. Use the same dataframe `by_order` to make a barplot that shows mean lifespan by order. Fill by mean mass and use `coord_flip()` to make the barplot horizontal.


4. Let's examine the range of mass by order. Make a quick boxplot with minimal aesthetics. You may want to use `coord_flip()` again to make the plot more readable. You should see that Cetacea (whales and relatives) are an outlier given their tremendous size.
```{r warning=FALSE}
life_history %>%
  ggplot(aes(x=order, y=mass))+
  geom_boxplot()+
  coord_flip()
```

5. Make a new boxplot that deals with this problem; i.e. how will you reflect the range of masses by mammalian order yet not have the plot overly skewed by Cetacea. There are lots of possible solutions here, so be creative.

## Push your final code to [GitHub](https://github.com/FRS417-DataScienceBiologists)
Make sure that you push your code into the appropriate folder. Also, be sure that you have check the `keep md` file in the knit preferences.